# 📧 小智邮件发送功能使用指南

## 🎯 功能概述

小智邮件发送功能可以通过语音指令自动发送包含天气信息和智能出行建议的邮件给指定联系人。

### ✨ 主要特性
- 🌤️ **天气信息播报**：获取实时天气和未来预报
- 👗 **穿衣建议**：根据天气情况智能推荐衣物搭配
- 🚗 **出行方式**：推荐最适合的交通工具
- 🏃‍♀️ **户外活动**：提供合适的户外活动建议
- 📮 **别名管理**：支持通过别名快速发送邮件
- 📧 **友好模板**：轻松活泼的邮件风格

## 🔧 配置步骤

### 🚨 重要提醒：配置文件优先级

小智系统的配置文件读取优先级为：
1. **智控台配置**（最高优先级）- 如果你使用了智控台
2. **data/.config.yaml**（次优先级）- 推荐使用这个文件
3. **config.yaml**（最低优先级）- 默认配置文件

**⚠️ 如果你使用了智控台，直接修改 `config.yaml` 文件是无效的！**

### 1. QQ邮箱配置

#### 步骤1：开启QQ邮箱SMTP服务
1. 登录[QQ邮箱](https://mail.qq.com)
2. 进入「设置」→「账户」
3. 找到「POP3/IMAP/SMTP/Exchange/CardDAV/CalDAV服务」
4. 开启「IMAP/SMTP服务」
5. 生成授权码（记住这个授权码，不是QQ密码）

#### 步骤2：修改配置文件

**重要：请修改 `data/.config.yaml` 文件，而不是 `config.yaml` 文件！**

在 `main/xiaozhi-server/data/.config.yaml` 中找到 `send_email` 配置段落，修改以下信息：

```yaml
plugins:
  send_email:
    smtp:
      server: "smtp.qq.com"
      port: 587
      username: "your-email@qq.com"      # 替换为你的QQ邮箱
      password: "your-authorization-code"  # 替换为你的QQ邮箱授权码
      sender_name: "小智助手"
```

#### 步骤3：检查配置生效
如果你的系统有以下情况之一，邮件配置会正常生效：
- ✅ 使用智控台，但在 `data/.config.yaml` 中配置了邮件参数
- ✅ 不使用智控台，在 `data/.config.yaml` 中配置了邮件参数
- ✅ 不使用智控台，在 `config.yaml` 中配置了邮件参数

### 2. 联系人别名配置

修改 `aliases` 部分，添加你的联系人：

```yaml
aliases:
  张三: "zhangsan@example.com"
  老板: "boss@company.com" 
  妈妈: "mom@family.com"
  同事小李: "xiaoli@company.com"
  # 根据需要添加更多联系人...
```

⚠️ **注意**：请将示例邮箱地址替换为真实的邮箱地址

### 3. 邮件模板自定义（可选）

如果需要修改邮件模板风格，可以编辑 `template` 部分：

```yaml
template: |
  嗨 {name}！👋
  
  今天是{date}，小智为你播报最新的天气信息：
  
  📍 位置：{location}
  🌤️ 当前天气：{current_weather}
  🌡️ 气温：{temperature}
  💨 风力情况：{wind}
  💧 湿度：{humidity}
  
  📅 未来几天预报：
  {forecast}
  
  🎯 贴心建议：
  👗 穿衣建议：{clothing_advice}
  🚗 出行方式：{transport_advice}  
  🏃‍♀️ 户外活动：{outdoor_advice}
  
  希望这些信息对你有帮助！记得根据天气调整出行计划哦～
  
  祝你今天心情和天气一样棒！☀️
  
  ——来自你的贴心小智 💕
```

## 📢 使用方法

### 🎤 语音指令示例

| 指令类型 | 语音指令示例 | 说明 |
|---------|-------------|------|
| 基础发送 | "小智，把天气发给张三" | 发送当前位置天气给张三 |
| 指定位置 | "小智，把北京的天气发给老板" | 发送北京天气信息给老板 |
| 多种表达 | "小智，告诉妈妈今天的天气情况" | 更自然的表达方式 |
| 同义词 | "小智，给同事小李发送天气邮件" | 支持多种说法 |

### ✅ 成功示例
**用户说**："小智，把今天的天气发给张三"

**小智回复**："邮件发送成功！已将广州的天气信息和出行建议发送给张三，请注意查收邮箱哦～"

**邮件内容预览**：
```
主题：🌤️ 2024年01月15日天气播报 - 来自小智的贴心提醒

嗨 张三！👋

今天是2024年01月15日，小智为你播报最新的天气信息：

📍 位置：广州
🌤️ 当前天气：多云
🌡️ 气温：22°C
💨 风力情况：微风
💧 湿度：65%

📅 未来几天预报：
  今天: 多云，18°C~25°C
  明天: 晴，19°C~26°C
  后天: 小雨，16°C~22°C

🎯 贴心建议：
👗 穿衣建议：适合穿薄外套或长袖衬衫
🚗 出行方式：建议选择公共交通或骑行
🏃‍♀️ 户外活动：适合散步和轻度运动

希望这些信息对你有帮助！记得根据天气调整出行计划哦～

祝你今天心情和天气一样棒！☀️

——来自你的贴心小智 💕
```

## ❌ 常见错误处理

### 联系人不存在
**用户说**："小智，把天气发给小王"
**小智回复**："抱歉，我不认识叫'小王'的联系人。已配置的联系人有：张三、老板、妈妈、同事小李"

### 邮件发送失败
**可能原因**：
- QQ邮箱授权码错误
- 网络连接问题
- SMTP服务器连接失败

**解决方法**：
1. 检查QQ邮箱授权码是否正确
2. 确认网络连接正常
3. 查看日志文件获取详细错误信息

## 📊 使用限制

- **频率限制**：每小时最多发送10封邮件，每天最多50封
- **联系人数量**：建议不超过10个联系人
- **邮件大小**：纯文本邮件，无附件

## 🔐 安全建议

1. **授权码安全**：妥善保管QQ邮箱授权码，不要泄露给他人
2. **联系人隐私**：定期检查联系人列表，确保信息准确
3. **定期更新**：建议定期更换QQ邮箱授权码

## 🚀 进阶使用

### 自定义位置发送
```
用户："小智，把杭州的天气发给老板"
系统：会发送杭州的天气信息而不是当前位置
```

### 批量联系人（计划功能）
未来版本可能支持：
- 群组发送功能
- 定时发送功能
- 更多邮件模板

## 📞 技术支持

如遇到问题，请：
1. 检查配置文件格式是否正确
2. 查看服务器日志：`tail -f tmp/server.log`
3. 确认依赖包已正确安装：`pip install beautifulsoup4`

---

*最后更新：2024年01月* 